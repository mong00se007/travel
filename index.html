<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Planner - Plan Your Perfect Journey</title>
    <link rel="icon" type="image/png" href="favicon.png">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">

    <!-- Inline styles for date/time pickers -->
    <style>
        /* Date and Time Picker Styling - make icons visible */
        input[type="date"],
        input[type="time"] {
            cursor: pointer;
            color-scheme: dark;
        }

        input[type="date"]::-webkit-calendar-picker-indicator,
        input[type="time"]::-webkit-calendar-picker-indicator {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            cursor: pointer;
            filter: invert(1);
            padding: 4px;
            opacity: 0.7;
        }

        input[type="date"]::-webkit-calendar-picker-indicator:hover,
        input[type="time"]::-webkit-calendar-picker-indicator:hover {
            background-color: rgba(255, 255, 255, 0.2);
            opacity: 1;
        }

        .light-mode input[type="date"],
        .light-mode input[type="time"] {
            color-scheme: light;
        }

        .light-mode input[type="date"]::-webkit-calendar-picker-indicator,
        .light-mode input[type="time"]::-webkit-calendar-picker-indicator {
            filter: none;
            background-color: rgba(0, 0, 0, 0.05);
        }

        .light-mode input[type="date"]::-webkit-calendar-picker-indicator:hover,
        .light-mode input[type="time"]::-webkit-calendar-picker-indicator:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }

        /* Nights Display - simple text, not a badge */
        .nights-display {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            color: var(--primary-color);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .nights-display i {
            color: #9b59b6;
        }
    </style>
</head>

<body>
    <div class="app-wrapper">
        <header class="main-header">
            <div class="logo">
                <i class="fa-solid fa-earth-americas"></i>
                <h1>Travel Planner</h1>
            </div>
            <div class="header-controls">
                <button id="themeToggle" class="btn btn-secondary" title="Toggle Dark/Light Mode">
                    <i class="fa-solid fa-moon"></i>
                </button>
                <button id="fullscreenBtn" class="btn btn-secondary" title="Toggle Full Screen">
                    <i class="fa-solid fa-expand"></i>
                </button>
                <button id="printBtn" class="btn btn-secondary" title="Print Itinerary">
                    <i class="fa-solid fa-print"></i>
                </button>
                <button id="settingsBtn" class="btn btn-secondary" title="Settings">
                    <i class="fa-solid fa-gear"></i>
                </button>
                <input type="file" id="importFile" accept=".kml" style="display: none;">
                <input type="file" id="importRestaurantsFile" accept=".csv" style="display: none;">
            </div>
        </header>

        <main class="main-content">
            <!-- Left Panel: Map -->
            <section class="map-section">
                <div class="map-container">
                    <div id="map"></div>
                    <div class="map-overlay-info">
                        <p><i class="fa-solid fa-circle-info"></i> Click on the map to add a new location</p>
                    </div>
                </div>
            </section>

            <!-- Right Panel: Itinerary -->
            <section class="itinerary-section">
                <div class="itinerary-header">
                    <h2>Your Journey</h2>
                    <span class="badge" id="locationCount">0 Stops</span>
                </div>

                <div class="itinerary-list" id="itineraryList">
                    <!-- Cards will be injected here -->
                    <div class="empty-state">
                        <i class="fa-solid fa-map-location-dot"></i>
                        <p>Start your journey by clicking on the map!</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal for Add/Edit Location -->
    <div id="locationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Add Location</h2>
                <button class="close-modal"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="modal-body">
                <form id="locationForm">
                    <input type="hidden" id="locationId">

                    <!-- Main Tabs Navigation -->
                    <div class="main-tabs">
                        <div class="main-tab active" data-tab="location" title="Location Details">
                            <i class="fa-solid fa-map-location-dot"></i>
                        </div>
                        <div class="main-tab" data-tab="stay" title="Place to Stay">
                            <i class="fa-solid fa-bed"></i>
                        </div>
                        <div class="main-tab" data-tab="activities" title="Activities">
                            <i class="fa-solid fa-binoculars"></i>
                        </div>
                        <div class="main-tab" data-tab="food" title="Food Options">
                            <i class="fa-solid fa-utensils"></i>
                        </div>
                        <div class="main-tab" data-tab="phrases" title="Phrases & Fun Fact">
                            <i class="fa-regular fa-comment"></i>
                        </div>
                    </div>

                    <!-- Tab 1: Location Details -->
                    <div class="main-tab-content active" id="tab-location">
                        <div class="form-group">
                            <label for="locationSearch">Search Location (Auto-fill)</label>
                            <div style="position: relative;">
                                <input type="text" id="locationSearch" placeholder="Type a city or place name...">
                                <i class="fa-solid fa-magnifying-glass"
                                    style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); color: #64748b;"></i>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="locationLat">Latitude</label>
                                <input type="number" id="locationLat" step="any" required placeholder="e.g., 48.8566">
                            </div>
                            <div class="form-group">
                                <label for="locationLng">Longitude</label>
                                <input type="number" id="locationLng" step="any" required placeholder="e.g., 2.3522">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="locationName">Location Name</label>
                            <input type="text" id="locationName" required placeholder="e.g., Eiffel Tower">
                        </div>

                        <div class="form-group">
                            <label for="imageUrl">Image URL (Background)</label>
                            <input type="url" id="imageUrl" placeholder="https://example.com/image.jpg">
                        </div>

                        <div class="form-group">
                            <label for="travelTime">Travel Time (from previous)</label>
                            <input type="text" id="travelTime" placeholder="e.g., 2h 30m (leave blank for estimate)">
                        </div>

                        <div class="form-group">
                            <label for="travelMode">Travel Mode</label>
                            <input type="hidden" id="travelMode">
                            <div class="travel-mode-selector">
                                <button type="button" class="travel-mode-btn" data-mode="walking" title="Walking">
                                    <i class="fa-solid fa-person-walking"></i>
                                </button>
                                <button type="button" class="travel-mode-btn" data-mode="biking" title="Biking">
                                    <i class="fa-solid fa-person-biking"></i>
                                </button>
                                <button type="button" class="travel-mode-btn" data-mode="car" title="Car">
                                    <i class="fa-solid fa-car"></i>
                                </button>
                                <button type="button" class="travel-mode-btn" data-mode="train" title="Train">
                                    <i class="fa-solid fa-train"></i>
                                </button>
                                <button type="button" class="travel-mode-btn" data-mode="boat" title="Boat">
                                    <i class="fa-solid fa-sailboat"></i>
                                </button>
                                <button type="button" class="travel-mode-btn" data-mode="plane" title="Plane">
                                    <i class="fa-solid fa-plane"></i>
                                </button>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="ticketNumber">Ticket/Booking Number</label>
                                <input type="text" id="ticketNumber" placeholder="e.g., ABC123">
                            </div>
                            <div class="form-group" style="flex: 0 0 140px;">
                                <label for="departureTime">Departure Time</label>
                                <input type="time" id="departureTime">
                            </div>
                        </div>
                    </div>

                    <!-- Tab 2: Place to Stay -->
                    <div class="main-tab-content" id="tab-stay">
                        <div class="form-group">
                            <label for="placeToStay">Accommodation Name</label>
                            <input type="text" id="placeToStay" placeholder="e.g., The Grand Hotel">
                        </div>
                        <div class="form-group">
                            <label for="stayAddress">Address (Search to get coordinates)</label>
                            <div style="position: relative;">
                                <input type="text" id="stayAddress" placeholder="Type address and wait...">
                                <i class="fa-solid fa-magnifying-glass"
                                    style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); color: #64748b;"></i>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="stayLat">Latitude</label>
                                <input type="number" id="stayLat" step="any" placeholder="0.00">
                            </div>
                            <div class="form-group">
                                <label for="stayLng">Longitude</label>
                                <input type="number" id="stayLng" step="any" placeholder="0.00">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="stayDateFrom">Check-in Date</label>
                                <input type="date" id="stayDateFrom">
                            </div>
                            <div class="form-group">
                                <label for="stayDateTo">Check-out Date</label>
                                <input type="date" id="stayDateTo">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group" style="flex: 0 0 130px;">
                                <label for="checkoutTime">Check-out Time</label>
                                <input type="time" id="checkoutTime">
                            </div>
                            <div class="form-group"
                                style="flex: 1; display: flex; align-items: flex-end; padding-bottom: 0.4rem;">
                                <div id="stayNightsDisplay" class="nights-display" style="display: none;">
                                    <i class="fa-solid fa-moon"></i>
                                    <span id="stayNightsCount">0</span> nights
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab 3: Activities -->
                    <div class="main-tab-content" id="tab-activities">
                        <div class="tabs">
                            <div class="tab active" data-tab="morning">Morning</div>
                            <div class="tab" data-tab="afternoon">Afternoon</div>
                            <div class="tab" data-tab="allday">All Day</div>
                        </div>
                        <div class="tab-content active" id="morning-content">
                            <textarea id="morningActivity" rows="3"
                                placeholder="What's the plan for the morning?"></textarea>
                        </div>
                        <div class="tab-content" id="afternoon-content">
                            <textarea id="afternoonActivity" rows="3"
                                placeholder="What's the plan for the afternoon?"></textarea>
                        </div>
                        <div class="tab-content" id="allday-content">
                            <textarea id="allDayActivity" rows="3"
                                placeholder="Is this a full day activity?"></textarea>
                        </div>

                        <div class="form-group" style="margin-top: 1rem;">
                            <label for="kidsActivity">For the Kids</label>
                            <input type="text" id="kidsActivity" placeholder="Fun stuff for children...">
                        </div>
                    </div>

                    <!-- Tab 4: Food Options -->
                    <div class="main-tab-content" id="tab-food">
                        <div class="form-group">
                            <label for="foodBreakfast">Breakfast</label>
                            <textarea id="foodBreakfast" rows="2" placeholder="Breakfast spots..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="foodLunch">Lunch</label>
                            <textarea id="foodLunch" rows="2" placeholder="Lunch spots..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="foodDinner">Dinner</label>
                            <textarea id="foodDinner" rows="2" placeholder="Dinner spots..."></textarea>
                        </div>
                    </div>

                    <!-- Tab 5: Phrases & Fun Fact -->
                    <div class="main-tab-content" id="tab-phrases">
                        <div class="form-group">
                            <label for="funFact">Fun Fact</label>
                            <textarea id="funFact" rows="3" placeholder="Did you know..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="phrases">Phrases</label>
                            <textarea id="phrases" rows="3" placeholder="Useful phrases..."></textarea>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary close-modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Location</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>Settings & Info</h2>
                <button class="close-modal" id="closeSettingsModal"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="modal-body">

                <!-- Settings Groups -->
                <div class="settings-group">
                    <h3><i class="fa-solid fa-layer-group"></i> View Options</h3>
                    <div class="setting-item">
                        <span>Show Restaurants on Map</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggleRestaurants" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <span>Show Supermarkets (10km radius)</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggleSupermarkets">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-group">
                    <h3><i class="fa-solid fa-database"></i> Data Management</h3>
                    <div class="action-grid">
                        <button id="modalImportBtn" class="btn btn-secondary">
                            <i class="fa-solid fa-upload"></i> Import Itinerary (KML)
                        </button>
                        <button id="modalExportBtn" class="btn btn-secondary">
                            <i class="fa-solid fa-download"></i> Export Itinerary (KML)
                        </button>
                        <button id="modalImportRestaurantsBtn" class="btn btn-secondary">
                            <i class="fa-solid fa-utensils"></i> Import Restaurants (CSV)
                        </button>
                        <button id="modalResetBtn" class="btn btn-secondary"
                            style="border-color: #ef4444; color: #ef4444;">
                            <i class="fa-solid fa-trash"></i> Reset All Data
                        </button>
                    </div>
                </div>

                <div class="settings-group">
                    <h3><i class="fa-solid fa-circle-info"></i> About & Instructions</h3>
                    <div class="info-content">

                        <p>Plan your trip, manage stops, and find great sights to visit. </p>
                        <p>Weather data provided by <a href="https://open-meteo.com/" target="_blank">Open-Meteo</a>.
                        </p>
                        <p>Travel Planner made with Antigravity AI</p>

                        <div class="instruction-box">
                            <h4>Importing Restaurants (CSV)</h4>
                            <p>Upload a CSV file with the following header format:</p>
                            <code>name, location, star_rating, price, type, dedicated_gluten_free, gf_menu_items, review</code>
                            <p class="note">Address (location) will be automatically geocoded using OpenStreetMap.</p>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <!-- SortableJS for Drag and Drop -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <!-- App Logic -->
    <script src="script.js"></script>
</body>

</html>